tool_id: anthropic_messages
tool_type: http
version: "1.0.0"
description: "Anthropic Messages API â€” system default provider for thread execution"
executor_id: rye/core/primitives/http_client
category: rye/agent/providers

requires:
  - net.call

env_config:
  env:
    ANTHROPIC_API_KEY: "${ANTHROPIC_API_KEY}"

config:
  method: POST
  url: "https://api.anthropic.com/v1/messages"

  auth:
    type: api_key
    key: "${ANTHROPIC_API_KEY}"
    header: x-api-key

  headers:
    Content-Type: application/json
    anthropic-version: "2023-06-01"

  body:
    model: "{model}"
    max_tokens: "{max_tokens}"
    system: "{system_prompt}"
    messages: "{messages}"
    tools: "{tools}"

  timeout: 120

  retry:
    max_attempts: 2
    backoff: exponential

parameters:
  - name: model
    type: string
    required: true
    default: "claude-3-5-haiku-20241022"
  - name: max_tokens
    type: integer
    required: true
    default: 1024
  - name: system_prompt
    type: string
    required: false
    default: ""
  - name: messages
    type: array
    required: true
    description: "Array of {role, content} message objects"
  - name: tools
    type: array
    required: false
    default: []
    description: "Array of tool definitions for function calling"

tool_use:
  tool_definition:
    name: "{name}"
    description: "{description}"
    input_schema: "{schema}"

  response:
    stop_reason_field: stop_reason
    stop_reason_tool_use: tool_use
    content_field: content
    text_block_type: text
    text_field: text
    tool_use_block_type: tool_use
    tool_use_id_field: id
    tool_use_name_field: name
    tool_use_input_field: input

  tool_result:
    role: user
    block_type: tool_result
    id_field: tool_use_id
    content_field: content
    error_field: is_error
